spec_version: 2
description: "EKS cluster deployment blueprint"

inputs:
  region:
    type: string
    default: us-east-1
    description: "AWS region for deployment"
  cluster_name:
    type: string
    default: yana-eks-demo
    description: "Name of the EKS cluster"
  vpc_id:
    type: string
    default: vpc-066d45cb6f15cce6e
    description: "VPC ID where cluster will be deployed"
  subnet_ids:
    type: string
    default: "subnet-04b1589da0f453bf0,subnet-024c12ca933afee95"
    description: "Comma-separated list of subnet IDs"
  agent:
    type: string
    default: "torque-agent-torqueagent02-dtvkcccjj"
    description: "Torque execution agent to use"

outputs:
  cluster_endpoint:
    value: '{{ .grains.eks_cluster.outputs.cluster_endpoint }}'
    kind: string
    quick: true
  cluster_name:
    value: '{{ .grains.eks_cluster.outputs.cluster_name }}'
    kind: string
    quick: true

grains:
  eks_cluster:
    kind: terraform
    spec:
      source:
        store: Quali-Torque-Assignment-EKS  # try without trailing dash
        path: .  # path to the Terraform files in the root directory
      host:
        name: '{{ .inputs.agent | default: "torque-agent-torqueagent02-dtvkcccjj" }}'
      inputs:
        - region: '{{ .inputs.region }}'
        - cluster_name: '{{ .inputs.cluster_name }}'
        - vpc_id: '{{ .inputs.vpc_id }}'
        - subnet_ids: '{{ .inputs.subnet_ids }}'
